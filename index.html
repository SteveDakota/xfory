<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>X for Y Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --ring: #222;
      --text: #111;
      --muted: #556070;
      --accent: #0d6efd;
      --highlight: #7CB2FF;
      --slice-a: #DCEBFF;
      --slice-b: #E8F6EF;
      --shadow: 0 6px 20px rgba(0,0,0,.08);
      --shadow-sm: 0 2px 8px rgba(0,0,0,.06);
      --border: 1px solid rgba(0,0,0,.06);
      --grad-a: #3498db;
      --grad-b: #2ecc71;
      --grad-c: #ff69b4;
      --grad-d: #ff9800;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 600px at 20% 0%, #eef3ff 0%, transparent 70%),
        radial-gradient(800px 500px at 80% 0%, #eefaf3 0%, transparent 70%),
        var(--bg);
      display:grid; place-items:start center; gap:20px; padding:28px 16px;
    }

    header{ text-align:center; max-width:1080px; width:100% }
    .title{
      font-size: 40px; margin:0 0 8px 0; letter-spacing:.2px; font-weight:900;
      background: linear-gradient(90deg, #4f8bff, #54d6b9);
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .kicker{ margin:0; color:var(--muted); font-size:18px }

    .stage{
      width:100%; max-width:1080px;
      display:flex; flex-wrap:wrap; gap:36px; justify-content:center; align-items:center;
      padding:8px 6px;
    }
    .pointer-wrap{
      position:relative; width:360px; height:360px;
      filter: drop-shadow(var(--shadow));
    }
    .pointer{
      position:absolute; left:50%; top:-2px; transform:translateX(-50%);
      width:0; height:0;
      border-left:12px solid transparent; border-right:12px solid transparent;
      border-top:18px solid #e63946;
      z-index:2;
    }
    canvas{
      width:360px; height:360px; background: var(--card);
      border-radius:50%;
      border:6px solid var(--ring);
      box-shadow: var(--shadow);
    }

    .cta{ text-align:center }
    .cta button{
      padding:14px 22px; border:0; border-radius:12px;
      background: var(--accent); color:#fff; font-weight:900; font-size:18px; cursor:pointer;
      box-shadow: 0 10px 24px rgba(13,110,253,.18);
      transition: transform .12s ease, filter .12s ease;
    }
    .cta button:hover{ transform: translateY(-1px) scale(1.01) }
    .cta button:active{ transform: translateY(0) scale(.99) }
    .cta small{ display:block; margin-top:8px; color:var(--muted) }

    .card{
      width:100%; max-width:1080px; border-radius:14px; padding:18px;
      background: var(--card);
      border: var(--border);
      box-shadow: var(--shadow);
    }
    .result-wrap h2, .exec-summary h2{
      margin:0 0 8px 0; font-size:20px; color:#334155; letter-spacing:.2px
    }
    .result{
      font-size:30px; font-weight:900; letter-spacing:.2px; min-height:40px;
      padding:12px 14px; border-radius:10px;
      background:#fafbff; border: var(--border);
    }
    #summary{
      font-size:18px; 
      line-height:1.5; 
      color:#3b4452;
    }
    #summary.placeholder{ color:#7a8596 }
    #summary strong { color: #111; }
    #summary ul, #summary ol { padding-left: 20px; }
    #summary li { margin-bottom: 8px; }
    #summary{ font-size:18px; line-height:1.5; color:#3b4452 }
    #summary.placeholder{ color:#7a8596 }

    .lists-intro{ max-width:1080px; width:100%; text-align:left; color:#334155 }
    .lists-intro h2{ margin:8px 0 6px 0; font-size:18px }
    .panel{ display:grid; grid-template-columns:1fr 1fr; gap:18px; width:100%; max-width:1080px }
    .box{
      background: var(--card); border: var(--border);
      border-radius:14px; padding:14px; box-shadow: var(--shadow-sm);
    }
    .box h3{ margin:2px 0 10px 0; font-size:16px; color:#334155; letter-spacing:.2px }
    textarea{
      width:100%; height:200px;
      background:#fbfcfe; color:#111;
      border:1px solid rgba(0,0,0,.12);
      border-radius:10px; padding:12px; resize:vertical;
      font: 14px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    textarea:focus{
      outline:0; border-color:#8db9ff; box-shadow: 0 0 0 3px rgba(141,185,255,.25);
    }

    .actions{ display:flex; justify-content:center; width:100% }
    .actions button{
      padding:10px 16px; border:0; border-radius:10px;
      background:#6c757d; color:#fff; font-weight:700; cursor:pointer;
      transition: background .18s ease, transform .12s ease;
    }
    .actions button:hover{ transform: translateY(-1px) }
    .actions button:active{ transform: translateY(0) scale(.99) }
    .actions button.dirty{ background: var(--accent) }

    .banner{
      width:100%;
      height:auto;
      min-height:120px;
      background:#fbfcfe;
      border:2px dashed rgba(0,0,0,.15);
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .banner img{
      width:100%;
      height:auto;
      object-fit:cover;
    }

    .hero-section{
      width:100%;
      max-width:1080px;
      background:#fff;
      border-radius:24px;
      padding:42px 32px;
      box-shadow: 0 25px 50px rgba(0,0,0,.08);
      position:relative;
      overflow:hidden;
      text-align:center;
      border: var(--border);
      margin-bottom: 18px; /* Reduced from 28px to create more space */
    }
    .hero-section::before{
      content:'';
      position:absolute; top:0; left:0; right:0; height:6px;
      background: linear-gradient(90deg, var(--grad-a), var(--grad-b)); /* blue-green */
    }
    .hero-section .tagline{
      font: 800 18px/1 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:#7a8596; text-transform:uppercase; letter-spacing:1.5px;
      margin-bottom:18px;
      display:flex; gap:10px; align-items:center; justify-content:center;
    }
    .hero-section .tagline .bulb{ font-size:22px }
    /* Blue "Spinning" that only shows while spinning */
    .hero-section .main-idea{
      display:none;
      font: 900 32px/1.1 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--accent);
      margin: 6px 0 2px 0;
    }
    .hero-section .main-idea.show{ display:block }

    .formula{
      background:#f8f9fa;
      border-radius:20px;
      padding:22px;
      margin:10px auto 0 auto;
      /* single left stripe only */
      border-left:8px solid var(--grad-a);
      position:relative;
      max-width:780px;
    }
    /* remove extra tab line */
    .formula::before{ content:none }

    .formula-text{
      font-weight:700; color:#2c3e50;
      font-size:22px; display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap;
    }
    .formula-breakdown{ font-size:16px; color:#556070; font-weight:600; margin-top:8px }
    .x-part, .y-part{
      background: linear-gradient(135deg, var(--grad-a), var(--grad-b));
      color:#fff; padding:10px 18px; border-radius:16px; font-weight:800; display:inline-block;
      transform: rotate(-2deg);
      box-shadow: 0 6px 20px rgba(102,126,234,.3);
      transition: transform .2s ease;
    }
    .x-part:hover, .y-part:hover{ transform: rotate(-2deg) scale(1.03) }
    .y-part{
      transform: rotate(2deg);
      background: linear-gradient(135deg, var(--grad-c), var(--grad-d));
      box-shadow: 0 6px 20px rgba(255,107,107,.28);
    }
    .hero-note{
      margin-top:12px; color:#556070; font-size:14px; font-weight:600;
    }

    /* Visually hide the legacy #result to keep JS compatibility */
    .visually-hidden{
      position:absolute !important; width:1px !important; height:1px !important;
      padding:0 !important; margin:-1px !important; overflow:hidden !important;
      clip: rect(0 0 0 0) !important; white-space:nowrap !important; border:0 !important;
    }

    .exec-summary {
      margin-top: 24px; /* Added space between hero and summary */
    }

    @media (max-width:920px){
      .pointer-wrap{ width:340px; height:340px }
      canvas{ width:340px; height:340px }
    }
    @media (max-width:760px){
      .panel{ grid-template-columns:1fr }
      .title{ font-size:34px }
      .pointer-wrap{ width:320px; height:320px }
      canvas{ width:320px; height:320px }
    }
  </style>
</head>
<body>

  <header>
    <h1 class="title">"It's like Tinder, but for..."</h1>
    <p class="kicker">Don't waste time thinking of your next idea. Spin the wheels. Disrupt an industry.</p>
  </header>

  <section class="stage">
    <div class="pointer-wrap">
      <div class="pointer"></div>
      <canvas id="wheelX" width="720" height="720" aria-label="Famous apps wheel"></canvas>
    </div>
    <div class="pointer-wrap">
      <div class="pointer"></div>
      <canvas id="wheelY" width="720" height="720" aria-label="Industries wheel"></canvas>
    </div>
  </section>

  <div class="cta">
    <button id="spinBtnTop">Spin the wheels</button>
    <small>Let the wheels decide your next billion-dollar business.</small>
  </div>

  <!-- HERO RESULT -->
  <section class="hero-section" id="hero">
    <div class="tagline"><span class="bulb">ðŸ’¡</span><span>Your next revolutionary idea is...</span></div>

    <!-- Blue "Spinning" status. Hidden when not spinning -->
    <div class="main-idea" id="spinStatus" aria-live="polite"></div>

    <div class="formula">
      <div class="formula-text">
        <span>It's like</span>
        <span class="x-part" id="xPart">Tinder</span>
        <span>but for</span>
        <span class="y-part" id="yPart">dentistry</span>
      </div>
      <div class="formula-breakdown" id="formulaBreakdown">It's like Tinder, but for dentistry.</div>
    </div>

    <div class="hero-note" id="heroNote">Press the Spin button.</div>

    <!-- Keep legacy result node for JS compatibility, but hide it -->
    <div id="result" class="visually-hidden">Click "Spin the wheels."</div>
  </section>

  <section class="card exec-summary">
    <h2>Don't worry, your co-founder is AI.</h2>
    <div id="summary" class="placeholder">An executive summary and business model will automatically be generated after you spin the wheels.</div>
  </section>

  <div class="lists-intro">
    <h2>Edit or create your own lists. Like Mad Libs, but for startups.</h2>
  </div>

  <section class="panel">
    <div class="box">
      <h3>Famous Apps that Changed Everything</h3>
      <textarea id="xListBox">Tinder
Uber
Airbnb
Netflix
Spotify
Stripe
OnlyFans
Polymarket
Amazon
Reddit
Snapchat
Duolingo
Venmo
TikTok
LinkedIn
Discord</textarea>
    </div>
    <div class="box">
      <h3>Industries ripe for disruption</h3>
      <textarea id="yListBox">dog walking
gardening
dentistry
fishing trips
memes
fashion
3d printing
elder care
space tourism
tattoos
yoga retreats
pizza reviews
weddings
esports coaching
plant care
comic books
home brewing
pottery classes
wine tasting</textarea>
    </div>
  </section>

  <div class="actions">
    <button id="applyBtn">Apply changes</button>
    <div id="listsError" style="color:#b42318; font-size:13px; margin:4px 0 12px 0; padding:4px; background:#fffaeb; border-radius:4px;"></div>
  </div>

  <section class="card sponsor">
    <h3>Sponsored By</h3>
    <a href="https://stabilityprotocol.com" target="_blank" rel="noopener noreferrer">
      <img src="assets/sponsor-banner.jpg" alt="Stability Protocol" style="width:100%; border-radius:12px; margin-top:8px;">
    </a>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <script>
    const MAX_ITEMS = 50, MIN_ITEMS = 2, MAX_LABEL = 60;

    function cleanList(text) {
      const seen = new Set();
      return text.split(/\r?\n/)
        .map(s => s.trim())
        .filter(Boolean)
        .map(s => s.slice(0, MAX_LABEL))
        .filter(s => !seen.has(s) && seen.add(s))
        .slice(0, MAX_ITEMS);
    }

    let xItems=[], yItems=[];
    let rotX=0, rotY=0;
    let lastX = -1, lastY = -1;
    const recentCombos = [];
    const RECENT_LIMIT = 10;

    function getLists(){
      xItems = cleanList(document.getElementById('xListBox').value);
      yItems = cleanList(document.getElementById('yListBox').value);
      validateLists();
    }

    function validateLists() {
      const xValid = xItems.length >= MIN_ITEMS && xItems.length <= MAX_ITEMS;
      const yValid = yItems.length >= MIN_ITEMS && yItems.length <= MAX_ITEMS;
      const isValid = xValid && yValid;
      
      document.getElementById('applyBtn').disabled = !isValid;
      document.getElementById('listsError').textContent = 
        isValid ? '' : `Each list needs ${MIN_ITEMS}-${MAX_ITEMS} items.`;
      
      return isValid;
    }

    function fitText(ctx, text, maxWidth, base){
      let size = base;
      ctx.font = `700 ${size}px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`;
      while(ctx.measureText(text).width > maxWidth && size > 12){
        size -= 1;
        ctx.font = `700 ${size}px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`;
      }
      return size;
    }

    function drawWheel(canvas, items, rotation, highlightIndex=-1){
      const ctx = canvas.getContext('2d');
      const W=canvas.width, H=canvas.height, R=W/2;
      ctx.clearRect(0,0,W,H);

      if(!items.length){
        ctx.fillStyle='#7a8596'; ctx.font='20px system-ui, Arial, sans-serif'; ctx.textAlign='center';
        ctx.fillText('Add items and Apply changes', R, H/2);
        return;
      }

      const slice = 2*Math.PI/items.length;
      const base = -Math.PI/2;

      for(let i=0;i<items.length;i++){
        const a0 = base + rotation + i*slice;
        const a1 = a0 + slice;

        ctx.beginPath(); ctx.moveTo(R,R); ctx.arc(R,R,R-3,a0,a1); ctx.closePath();

        if(i === highlightIndex){
          ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--highlight').trim();
        }else{
          ctx.fillStyle = (i % 2 === 0)
            ? getComputedStyle(document.documentElement).getPropertyValue('--slice-a').trim()
            : getComputedStyle(document.documentElement).getPropertyValue('--slice-b').trim();
        }
        ctx.fill();

        ctx.strokeStyle = 'rgba(0,0,0,.06)';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(R,R);
        ctx.rotate(a0 + slice/2);
        ctx.textAlign='right';
        ctx.fillStyle='#1f2937';
        const pad=26, maxW=R - pad;
        const size=fitText(ctx, items[i], maxW, 20);
        ctx.font=`700 ${size}px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`;
        ctx.fillText(items[i], R - pad, 8);
        ctx.restore();
      }

      // Center hub
      ctx.beginPath();
      ctx.arc(R, R, 10, 0, 2*Math.PI);
      ctx.fillStyle = '#dfe6f3';
      ctx.fill();
      ctx.strokeStyle = 'rgba(0,0,0,.08)';
      ctx.stroke();
    }

    function redraw(){
      drawWheel(document.getElementById('wheelX'), xItems, rotX);
      drawWheel(document.getElementById('wheelY'), yItems, rotY);
    }

    // randomness
    function randInt(n){
      if (window.crypto && crypto.getRandomValues) {
        const buf = new Uint32Array(1);
        crypto.getRandomValues(buf);
        return buf[0] % n;
      }
      return Math.floor(Math.random()*n);
    }
    function pickIndex(n, last){
      if(n <= 1) return 0;
      let i = randInt(n), guard = 0;
      while(i === last && guard++ < 10) i = randInt(n);
      return i;
    }
    const key = (ix,iy)=>`${ix}|${iy}`;
    function chooseNonRepeating(xLen, yLen){
      let ix = pickIndex(xLen, lastX);
      let iy = pickIndex(yLen, lastY);
      let k = key(ix,iy), guard=0;
      while(recentCombos.includes(k) && guard++ < 20){
        ix = pickIndex(xLen, lastX);
        iy = pickIndex(yLen, lastY);
        k = key(ix,iy);
      }
      lastX = ix; lastY = iy;
      recentCombos.push(k);
      if(recentCombos.length > RECENT_LIMIT) recentCombos.shift();
      return {ix, iy};
    }

    // normalize to [0, 2Ï€)
    function norm(a){ const t = 2*Math.PI; return ((a % t) + t) % t; }

    function spinOnce(canvasId, items, currentRot, index){
      if(!items.length) return Promise.resolve({rot:currentRot, index:-1});
      const slice = 2*Math.PI/items.length;

      // We want final rotation so the chosen slice center is at 12 o'clock:
      // base + rotation + i*slice + slice/2 = -Ï€/2  â†’ rotation = - (i + 0.5) * slice (mod 2Ï€)
      const finalRot = norm(- (index + 0.5) * slice);

      // Make the wheel spin forward several full turns and land on finalRot
      const baseTurns = 6 + Math.floor(Math.random()*5); // 6..10
      const target = finalRot + baseTurns * 2*Math.PI;
      const duration = 1100 + Math.random()*900;

      return animateSpin(canvasId, items, currentRot, target, duration, index)
             .then(()=>({rot: finalRot, index}));
    }

    function animateSpin(canvasId, items, from, to, durationMs, finalIndex){
      return new Promise(resolve=>{
        const start = performance.now();
        const canvas = document.getElementById(canvasId);
        function frame(now){
          const t = Math.min(1, (now-start)/durationMs);
          const ease = 1 - Math.pow(1 - t, 3);
          const angle = from + (to - from) * ease;
          if(t < 1) drawWheel(canvas, items, angle, -1);
          else drawWheel(canvas, items, angle, finalIndex);
          if(t < 1) requestAnimationFrame(frame); else resolve();
        }
        requestAnimationFrame(frame);
      });
    }

    // Apply changes
    const applyBtn = document.getElementById('applyBtn');
    const xBox = document.getElementById('xListBox');
    const yBox = document.getElementById('yListBox');

    xBox.addEventListener('input', () => {
      applyBtn.classList.add('dirty');
      getLists();
      validateLists();
    });

    yBox.addEventListener('input', () => {
      applyBtn.classList.add('dirty');
      getLists();
      validateLists();
    });

    document.getElementById('applyBtn').addEventListener('click', ()=>{
      getLists();
      if (!validateLists()) return;
      
      rotX=rotY=0; redraw();
      document.getElementById('result').textContent = 'Lists updated. Spin again.';
      applyBtn.classList.remove('dirty');
      recentCombos.length = 0; lastX = lastY = -1;
    });

    async function spinBoth(){
      if(!xItems.length || !yItems.length) return;
      const summaryEl = document.getElementById('summary');
      const spinStatus = document.getElementById('spinStatus');

      // Show blue "Spinning"
      spinStatus.textContent = 'Spinning...';
      spinStatus.classList.add('show');

      document.getElementById('result').textContent = 'Spinning...';
      summaryEl.classList.add('placeholder');
      summaryEl.textContent = 'Preparing summary...';

      const choice = chooseNonRepeating(xItems.length, yItems.length);

      const xSpin = await spinOnce('wheelX', xItems, rotX, choice.ix); rotX = xSpin.rot;
      const ySpin = await spinOnce('wheelY', yItems, rotY, choice.iy); rotY = ySpin.rot;

      const x = xItems[choice.ix];
      const y = yItems[choice.iy];

      // Update formula result
      document.getElementById('xPart').textContent = x;
      document.getElementById('yPart').textContent = y;
      document.getElementById('formulaBreakdown').textContent = `It's like ${x}, but for ${y}.`;

      // Legacy node
      document.getElementById('result').textContent = `${x} for ${y}`;

      // Hide spinning status
      spinStatus.textContent = '';
      spinStatus.classList.remove('show');

      // Update note
      document.getElementById('heroNote').textContent = "You're going to be rich!";

      try {
        const r = await fetch("https://x-for-y-summary.steve-2cc.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ app: x, niche: y })
        });
        const data = await r.json();
        const parsed = marked.parse(data.summary || "No summary returned.");
        summaryEl.innerHTML = DOMPurify.sanitize(parsed);
        summaryEl.classList.remove("placeholder");
      } catch (e) {
        console.error('Summary fetch error:', e);
        summaryEl.textContent = `Failed to load summary. ${e.message}`;
        summaryEl.classList.add("placeholder");
      }
    }

    document.getElementById('spinBtnTop').addEventListener('click', spinBoth);

    // init
    getLists(); redraw();
  </script>
  <script>
    /* 
    Cloudflare Worker should implement:

    const corsHeaders = {
      'Access-Control-Allow-Origin': 'https://xfory.vercel.app',
      'Access-Control-Allow-Methods': 'POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type'
    };

    // Handle OPTIONS preflight
    async function handleOptions(request) {
      if (request.headers.get('Origin') !== 'https://xfory.vercel.app') {
        return new Response(null, { status: 403 });
      }
      return new Response(null, { headers: corsHeaders });
    }

    // Add to your worker handler:
    if (request.method === 'OPTIONS') {
      return handleOptions(request);
    }

    // Add CORS headers to all responses
    const response = new Response(...);
    Object.entries(corsHeaders).forEach(([key, value]) => {
      response.headers.set(key, value);
    });
    */
  </script>
</body>
</html>
